# CI/CD pipeline dla Diagnostic Center
# Uruchamia się przy każdym pushu lub PR na main/develop
# Weryfikuje poprawność kodu backendu (Django)

name: Django CI

on: 
    push:
        branches: [ main, develop]
    pull_request:
        branches: [main, develop]

jobs:
    backend:
        name: Run Django checks
        runs-on: ubuntu-latest
        
        steps:
            - name: Checkout repo
              uses: actions/checkout@v3
      
            - name: Set up Python
              uses: actions/setup-python@v4
              with:
                python-version: "3.12"
      
            - name: Install dependencies
              run: |
                cd backend
                python -m venv venv
                source venv/bin/activate
                pip install -r requirements.txt
      
            - name: Django check
              run: |
                cd backend
                source venv/bin/activate
                python manage.py check
      
            - name: Django migrate
              run: |
                cd backend
                source venv/bin/activate
                python manage.py migrate --noinput